<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trilha Frei Leandro | Narrativas</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body {
            display: flex;
            margin: 0;
            font-family: Arial, sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        .narrative-panel {
            width: 35%;
            background-color: #f8f8f8;
            padding: 20px;
            overflow-y: auto;
            border-right: 1px solid #ddd;
            box-sizing: border-box;
        }
        .narrative-section {
            margin-bottom: 20px;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .narrative-section:hover {
            background-color: #e0e0e0;
        }
        .narrative-section h2 {
            margin: 0;
            font-size: 20px;
        }
        .viewer {
            width: 65%;
            height: 100%;
            position: relative;
            display: none; /* Oculto por padrão */
        }
        .map-container,
        .image-container,
        .osm-container {
            width: 100%;
            height: 100%;
            position: absolute;
            display: none;
        }
        #image-viewer {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>

<div class="narrative-panel">
    <div class="narrative-section" data-type="map">
        <h2>Trilha Frei Leandro</h2>
        <p>Visualize o percurso da Trilha Frei Leandro no Jardim Botânico...</p>
    </div>
    <div class="narrative-section" data-type="image" data-image-url="https://upload.wikimedia.org/wikipedia/commons/e/e6/Camellia_sinensis_drawing.jpg">
        <h2>Chá (Camellia sinensis)</h2>
        <p>Veja uma ilustração botânica da planta do chá...</p>
    </div>
    <div class="narrative-section" data-type="osm">
        <h2>Mapa do Jardim Botânico</h2>
        <p>Visualize o mapa completo do Jardim Botânico no OSM...</p>
    </div>
    <!-- Adicione outras narrativas aqui com a mesma estrutura -->
</div>

<div class="viewer">
    <!-- Contêiner do Mapa com a Trilha -->
    <div id="map-container" class="map-container"></div>
    
    <!-- Contêiner da Imagem -->
    <div id="image-container" class="image-container">
        <div id="image-viewer"></div>
    </div>

    <!-- Contêiner do OpenStreetMap -->
    <div id="osm-container" class="osm-container"></div>
</div>

<!-- Scripts -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.5.0/gpx.min.js"></script>
<script>
    const viewer = document.querySelector('.viewer');
    const mapContainer = document.getElementById('map-container');
    const imageContainer = document.getElementById('image-container');
    const osmContainer = document.getElementById('osm-container');

    // Inicializar o mapa com a trilha GPX
    let trailMap;
    function initializeTrailMap() {
        if (!trailMap) {
            trailMap = L.map('map-container').setView([-22.9674, -43.2291], 16);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(trailMap);

            // Adicionar a trilha GPX
            new L.GPX('https://raw.githubusercontent.com/joaopdahmer/JBRJ_TESTE2/main/trilha_frei_leandro.gpx', {
                async: true,
                polyline_options: { color: 'blue', opacity: 0.75, weight: 5 }
            }).addTo(trailMap);
        }
    }

    // Inicializar o visualizador de imagem
    const imageViewer = L.map('image-viewer', {
        crs: L.CRS.Simple,
        minZoom: -4,
        zoomControl: true,
        zoomSnap: 0.1
    }).setView([0, 0], 0);

    function showImage(url) {
        imageViewer.eachLayer(layer => imageViewer.removeLayer(layer));
        L.imageOverlay(url, [[-100, -100], [100, 100]]).addTo(imageViewer);
        imageViewer.fitBounds([[-100, -100], [100, 100]]);
    }

    // Inicializar o OpenStreetMap focado no Jardim Botânico
    let osmMap;
    function initializeOSMMap() {
        if (!osmMap) {
            osmMap = L.map('osm-container').setView([-22.9674, -43.2291], 16);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(osmMap);
        }
    }

    // Alterna entre mapa, imagem e OSM ao clicar na narrativa
    document.querySelectorAll('.narrative-section').forEach(section => {
        section.addEventListener('click', function() {
            const type = this.getAttribute('data-type');
            const imageUrl = this.getAttribute('data-image-url');

            // Esconde visualizações anteriores
            mapContainer.style.display = 'none';
            imageContainer.style.display = 'none';
            osmContainer.style.display = 'none';
            viewer.style.display = 'none';

            if (type === 'map') {
                initializeTrailMap();
                mapContainer.style.display = 'block';
                viewer.style.display = 'block';
            } else if (type === 'image' && imageUrl) {
                showImage(imageUrl);
                imageContainer.style.display = 'block';
                viewer.style.display = 'block';
            } else if (type === 'osm') {
                initializeOSMMap();
                osmContainer.style.display = 'block';
                viewer.style.display = 'block';
            }
        });
    });
</script>

</body>
</html>
